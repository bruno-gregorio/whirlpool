#!/bin/bash
set -e

[ ! -x /usr/bin/dracut ] && exit 1

mkdir -p /etc/dracut.conf.d
cat > /etc/dracut.conf.d/10-whirlpool-live.conf << 'EOF'
hostonly="no"
hostonly_cmdline="no"
compress="zstd"
add_dracutmodules+=" livenet dmsquash-live convertfs pollcdrom "
omit_dracutmodules+=" plymouth "
filesystems+=" squashfs overlay "
add_drivers+=" squashfs overlay loop "
EOF
